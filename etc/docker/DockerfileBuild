FROM ubuntu:14.04
MAINTAINER Dion Whitehead Amago

# Haxe environment variables
ENV HAXE_STD_PATH /root/haxe/std/
ENV PATH /root/haxe/:$PATH
# Neko environment variables
ENV NEKOPATH /root/neko/
ENV LD_LIBRARY_PATH /root/neko/
ENV PATH /root/neko/:$PATH

ENV HAXE_DOWNLOAD_URL http://haxe.org/website-content/downloads/3.3.0-rc.1/downloads/haxe-3.3.0-rc.1-linux64.tar.gz

# Dependencies
RUN apt-get update && \
	apt-get install -y wget curl git g++ g++-multilib libgc-dev && \
	mkdir /root/haxe && \
	wget -O - $HAXE_DOWNLOAD_URL | tar xzf - --strip=1 -C "/root/haxe" && \
	mkdir /root/neko && \
	wget -O - http://nekovm.org/_media/neko-2.0.0-linux64.tar.gz | tar xzf - --strip=1 -C "/root/neko"  && \
	apt-get -y remove wget curl && \
	apt-get -y clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*


ENV APP /app
RUN mkdir -p $APP
WORKDIR $APP

RUN haxelib newrepo

#Only install haxe packages if the package.json changes
ADD ./etc/hxml/base.hxml $APP/etc/hxml/base.hxml
ADD ./etc/hxml/base-nodejs.hxml $APP/etc/hxml/base-nodejs.hxml
RUN haxelib install --always etc/hxml/base.hxml && haxelib install --always etc/hxml/base-nodejs.hxml
